import{d as N,c as T,u as j,r as n,n as B,b as R,w as V,e as s,f as d,g as w,_ as z,h as f,i as A,t as M,p as O,j as y,l as P,o as m,m as U}from"./index-CW84L7Dy.js";import{W as D}from"./WaterMark-BgblRerj.js";import{L as h}from"./LineEdit-D2N9ICyw.js";const W={class:"auth-layout"},$={class:"auth-content"},J={class:"form-group"},Z={class:"control-panel"},q=["disabled"],G={key:0},H={key:1},K={class:"to-signup"},Q=N({__name:"LogInView",setup(X){const k=j(),x=P(),b=T(()=>k.meta.watermark_text),i=n(""),c=n(""),p=n(!1),v=n(!1),r=n(!1),a=n(""),g=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim()),C=t=>t.trim()?g(t)?{isValid:!0}:S(t):{isValid:!1,message:"账号不能为空"},S=t=>t.length<3?{isValid:!1,message:"用户名长度至少3位"}:t.length>20?{isValid:!1,message:"用户名长度不能超过20位"}:/^[a-zA-Z0-9_]+$/.test(t)?{isValid:!0}:{isValid:!1,message:"用户名只能包含字母、数字和下划线"},L=t=>t.trim()?{isValid:!0}:{isValid:!1,message:"密码不能为空"},_=(t,e)=>{t==="account"?p.value=e:t==="password"&&(v.value=e)},u=()=>{["gender","email","nickname","username","timestamp","auth_method","user_id","session_id"].forEach(e=>{localStorage.removeItem(e)})},F=t=>{u(),Object.entries(t).forEach(([e,o])=>{e!=="message"&&localStorage.setItem(e,String(o))})},E=async()=>{if(!p.value||!v.value){a.value="请填写正确的账号和密码";return}const t={password:c.value.trim()};g(i.value.trim())?t.email=i.value.trim():t.username=i.value.trim(),r.value=!0,a.value="";try{const e=await fetch("/api/auth/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await e.json();e.ok?(a.value=o.message,F(o),setTimeout(()=>{x.push("/")},1500)):(a.value=o.message||"登录失败，请检查账号和密码",u())}catch(e){console.error("登录请求失败:",e),a.value="网络错误，请稍后重试",u()}finally{r.value=!1}};return B(()=>{u()}),(t,e)=>{const o=w("router-view"),I=w("router-link");return m(),R(D,{text:b.value,fontSize:18,fontColor:"#FFFFFF",opacity:.5,rotate:-30},{default:V(()=>[s("div",W,[s("main",$,[d(o),e[8]||(e[8]=s("div",{class:"top-form"},[s("h1",null,"登录系统"),s("img",{src:z,alt:"logo",width:"128px"})],-1)),s("div",J,[a.value?(m(),f("div",{key:0,class:O(["login-message",{"success-message":a.value.includes("成功")}])},M(a.value),3)):A("",!0),d(h,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),label:"Account*",placeholder:"用户名或邮箱",type:"text",validator:C,"validate-on-input":"",onValidityChange:e[1]||(e[1]=l=>_("account",l))},null,8,["modelValue"]),e[6]||(e[6]=s("p",{class:"hint-text"},"可以使用用户名或邮箱登录",-1)),d(h,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),label:"Password*",placeholder:"密码",type:"password",validator:L,onValidityChange:e[3]||(e[3]=l=>_("password",l))},null,8,["modelValue"]),e[7]||(e[7]=s("p",{class:"hint-text"},"请输入密码",-1)),s("div",Z,[s("button",{type:"button",class:"submit-btn",onClick:E,disabled:!p.value||!v.value||r.value},[r.value?(m(),f("span",G,"登录中...")):(m(),f("span",H,"登录 >"))],8,q)]),s("div",K,[s("p",null,[e[5]||(e[5]=y("第一次使用？",-1)),d(I,{to:"/signup"},{default:V(()=>[...e[4]||(e[4]=[y("注册",-1)])]),_:1})])])])])])]),_:1},8,["text"])}}}),se=U(Q,[["__scopeId","data-v-1bbe1c52"]]);export{se as default};
